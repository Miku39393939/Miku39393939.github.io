<span id="more"></span>
<html>
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>第七次全国人口普查数据可视化</title>    
</head>

<body>
    <h1 align="center">第七次全国人口普查数据可视化</h1>
    <h5 align="left" style="color:gray">数据来源：国家统计局《第七次全国人口普查公报》</h5>
    <div class="container">
        <div id="svg1"></div>
    </div>
    <h4 align="center">全国人口共141178万人，与2010年的133972万人相比，增加了7206万人，增长5.38%；年平均增长率为0.53%，比2000年到2010年的年平均增长率0.57%下降0.04个百分点。数据表明，我国人口10年来继续保持低速增长态势。</h4>
    <text id="myText"></text>
    <div>
        <svg id='svg2' />
    </div>
    <h3 align="center">男性人口为723339956人，占51.24%；女性人口为688438768人，占48.76%。总人口性别比（以女性为100，男性对女性的比例）为105.07，与2010年第六次全国人口普查基本持平。</h3>
    <div>
        <svg id='svg3' />
    </div>
    <h5 align="right">18软工冉苇、20人工智能杨宇森</h5>
</body>
    <script src="/source-src/js/d3.layout.cloud.js"></script>
   <script src="/source-src/js/d3.min.js"></script>
    <script>
        var w = window.innerWidth
|| document.documentElement.clientWidth
|| document.body.clientWidth;
        var h1 = window.innerHeight
|| document.documentElement.clientHeight
|| document.body.clientHeight;
        var h=550
            padding = {
                top: 50,
                right: 40,
                bottom: 40,
                left: 80
                };
        var city = ['北京','天津','河北','山西','内蒙古','辽宁','吉林','黑龙江','上海','江苏',
                    '浙江','安徽','福建','江西','山东','河南','湖北','湖南','广东','广西',
                    '海南','重庆','四川','贵州','云南','西藏','陕西','甘肃','青海','宁夏',
                    '新疆',''];
        var population = [21893095,13866009,74610235,34915616,24049155,42591407,24073453,31850088,24870895,84748016,64567588,
                          61027171,41540086,45188635,101527453,99365519,57752557,66444864,126012510,50126804,10081232,32054159,83674866,38562148,47209277,
                          3648100,39528999,25019831,5923957,7202654,25822345];
        const sexData = [ { 'x': '男性', 'y': 723339956 },
                          { 'x': '女性', 'y': 688438768 }];
        var nodes = [ { name: "北京" },{ name: "天津" },{ name: "河北" }, { name: "山西" },{ name: "内蒙古" },{ name: "辽宁" },{ name: "吉林" },{ name: "黑龙江" },{ name: "上海" },{ name: "江苏" },
                      { name: "浙江" },{ name: "安徽" },{ name: "福建" }, { name: "江西" },{ name: "山东" },  { name: "河南" },{ name: "湖北" },{ name: "湖南" },{ name: "广东" },{ name: "广西" },
                      { name: "海南" },{ name: "重庆" }, { name: "四川" },{ name: "贵州" },  { name: "云南" },{ name: "西藏" },{ name: "陕西" },{ name: "甘肃" },{ name: "青海" },{ name: "宁夏" },
                      { name: "新疆" }];
        var links = [ { source : 0 , target: 1 } , { source : 0 , target: 2 } ,
                      { source : 1 , target: 2 } ,
                      { source : 2 , target: 3 } , { source : 2 , target: 4 } ,{ source : 2 , target: 5 } ,{ source : 2 , target: 14 } ,{ source : 2 , target: 15 } ,
                      { source : 3 , target: 4 } , { source : 3 , target: 15 }, { source : 3 , target: 26 } ,
                      { source : 4 , target: 5 } , { source : 4 , target: 6 }, { source : 4 , target: 7 } ,{ source : 4 , target: 26 } , { source : 4 , target: 27 } , { source : 4 , target: 29 } , 
                      { source : 5 , target: 6 } , 
                      { source : 6 , target: 7 } ,                       
                      { source : 8 , target: 9 } , { source : 8 , target: 10 } , 
                      { source : 9 , target: 10 } ,{ source : 9 , target: 11 } ,{ source : 9 , target: 14 } , 
                      { source : 10 , target: 11 } ,{ source : 10 , target: 12 } ,{ source : 10 , target: 13 } ,
                      { source : 11 , target: 13 } ,{ source : 11 , target: 14 } ,{ source : 11 , target: 15 } ,{ source : 11 , target: 16 } ,
                      { source : 12 , target: 13 } ,{ source : 12 , target: 18 } ,
                      { source : 13 , target: 16 } ,{ source : 13 , target: 17 } ,{ source : 13 , target: 18 } ,
                      { source : 14 , target: 15 } ,
                      { source : 15 , target: 16 } ,{ source : 15 , target: 26 } ,
                      { source : 16 , target: 17 } ,{ source : 16 , target: 21 } ,{ source : 16 , target: 26 } ,
                      { source : 17 , target: 18 } ,{ source : 17 , target: 19 } ,{ source : 17 , target: 21 } ,{ source : 17 , target: 23 } ,
                      { source : 18 , target: 19 } ,{ source : 18 , target: 20 } ,
                      { source : 19 , target: 23 } ,{ source : 19 , target: 24 } ,
                      { source : 21 , target: 22 } ,{ source : 21 , target: 23 } ,{ source : 21 , target: 26 } ,
                      { source : 22 , target: 23 } ,{ source : 22 , target: 24 } ,{ source : 22 , target: 25 } ,{ source : 22 , target: 26 } ,{ source : 22 , target: 27 } ,{ source : 22 , target: 28 } ,
                      { source : 23 , target: 24 } ,
                      { source : 24 , target: 25 } ,
                      { source : 25 , target: 28 } ,{ source : 25 , target: 30 } ,
                      { source : 26 , target: 27 } ,{ source : 26 , target: 29 } ,
                      { source : 27 , target: 28 } ,{ source : 27 , target: 29 } ,{ source : 27 , target: 30 } ,
                      { source : 28 , target: 30 } ];      
        var words=[{text:"北京", size:21}, {text: "天津",size:13} , {text:"河北",size:74} , {text :"山西",size:34},{text :"内蒙古",size:24},{text :"辽宁",size:42},{text :"吉林",size:24},{text :"黑龙江",size:31},
                   {text :"上海",size:24}, {text :"江苏",size:84} , {text:"浙江",size:64} , {text :"安徽",size:61},{text :"福建"  ,size:41},{text :"江西",size:45},{text :"山东",size:101},{text :"河南" ,size:99},
                   {text:"湖北", size:57}, {text: "湖南",size:66} , {text:"广东",size:126}, {text:"广西",size: 50},{text :"海南",size:10},{text :"重庆",size:32},{text :"四川",size:83},{text :"贵州",size:38},
                   {text:"云南", size: 47}, {text:"西藏",size: 3},{text :"陕西",size:39},{text :"甘肃",size:25},{text :"青海",size:5},{text :"宁夏",size:7},{text :"新疆",size:25}];
        
        var svg1 = d3.select("#svg1")
        .append("svg")    
        .attr("width", w)
        .attr("height", h+50)
        .call(d3.zoom() //创建缩放行为
            .scaleExtent([-5, 2])
            .on('zoom',zoom_actions)); //设置缩放范围
        var color = d3.scaleOrdinal(d3.schemeCategory20);  //生成颜色选择器函数，此函数返回颜色数组 (string [])
        //词云图svg1.left    
        var wc=d3.layout.cloud()
                 .size([w/2,h+50])
                 .words(words)
                 .fontSize(function(d){return d.size;})
                 .on("end",draw)
                 .start();
                        
        function draw(){        
        svg1.selectAll("text")
           .data(words)
           .enter()
           .append("text")
           .attr("fill",function(d,i){return color(i);})
           .attr("font-size",function(d){return d.size;})
           .attr("transform",function(d){
             return "translate("+(w/5+d.x)+","+(h/2+d.y)+")";
           })
           .text(function(d){return d.text;})
        }


<p>​<br>​<br>        //力导向图svg1.rigth</p>
<pre><code>    //初始化力学仿真器，通过布局函数格式化数据    
var simulation = d3.forceSimulation(nodes)
    .force(&quot;link&quot;, d3.forceLink(links).distance(70))   //distance设置连线距离
    .force(&quot;charge&quot;, d3.forceManyBody().strength(-100))  //注1&gt; 
    .force(&quot;center&quot;, d3.forceCenter(w / 1.5, h / 2))  //设置力学仿真器的中心
    .on(&quot;tick&quot;, ticked);  

//布局函数格式化后的数据，注2&gt;
console.log(&#39;nodes&#39;, nodes);
console.log(&#39;links&#39;, links);  

//var color = d3.scaleOrdinal(d3.schemeCategory20);  //生成颜色选择器函数，此函数返回颜色数组 (string [])

 //添加group包裹svg元素以进行缩放，目的是在缩放时不会影响整个容器的位置
var g = svg1.append(&quot;g&quot;)
.attr(&quot;class&quot;, &quot;everything&quot;);

// 绘制连线
var svg_links = g.append(&#39;g&#39;)
    .selectAll(&quot;line&quot;)
    .data(links)
    .enter()
    .append(&quot;line&quot;)
    .style(&quot;stroke&quot;, &quot;#ccc&quot;)
    .style(&quot;stroke-width&quot;, 3)


// 绘制节点    
var svg_nodes = g.append(&#39;g&#39;)
    .selectAll(&quot;circle&quot;)
    .data(nodes)
    .enter()
    .append(&quot;circle&quot;)
    .attr(&quot;r&quot;, &#39;15&#39;)
    .style(&quot;fill&quot;, function (d, i) &#123;
        return color(i);
    &#125;).call(d3.drag().on(&quot;start&quot;, dragstarted) //d3.drag() 创建一个拖曳行为
      .on(&quot;drag&quot;, dragged)
      .on(&quot;end&quot;, dragended));
   
//绘制描述节点的文字
var svg_texts =  g.append(&#39;g&#39;)
    .selectAll(&quot;text&quot;)
    .data(nodes)
    .enter()
    .append(&quot;text&quot;)
    .style(&quot;fill&quot;, &quot;black&quot;)
    .attr(&quot;dx&quot;, 20)
    .attr(&quot;dy&quot;, 8)
    .text(function (d) &#123;
        return d.name;
    &#125;);

//监听拖拽开始    
function dragstarted(d) &#123;
    if (!d3.event.active) simulation.alphaTarget(0.3).restart(); //alpha是动画的冷却系数，运动过程中会不断减小，直到小于0.005为止，此时动画会停止。
    d.fx = d.x;    //fx为固定坐标，x为初始坐标  注3&gt;  
    d.fy = d.y;
&#125;

//监听拖拽中  
function dragged(d) &#123;
    d.fx = d3.event.x;  //fevent.x为拖拽移动时的坐标
    d.fy = d3.event.y;
&#125;

//监听拖拽结束
function dragended(d) &#123;
    if (!d3.event.active) simulation.alphaTarget(0);
    d.fx = null;        //固定坐标清空
    d.fy = null;
&#125;

function zoom_actions() &#123; 
    g.attr(&quot;transform&quot;, d3.event.transform)
 &#125;

//拖拽时的事件监听器  以实时更新坐标
function ticked() &#123;
    svg_links.attr(&quot;x1&quot;, function (d) &#123;
            return d.source.x;
        &#125;)
        .attr(&quot;y1&quot;, function (d) &#123;
            return d.source.y;
        &#125;)
        .attr(&quot;x2&quot;, function (d) &#123;
            return d.target.x;
        &#125;)
        .attr(&quot;y2&quot;, function (d) &#123;
            return d.target.y;
        &#125;);

    svg_nodes.attr(&quot;cx&quot;, function (d) &#123;
            return d.x;
        &#125;)
        .attr(&quot;cy&quot;, function (d) &#123;
            return d.y;
        &#125;);

    svg_texts.attr(&quot;x&quot;, function (d) &#123;
            return d.x;
        &#125;)
        .attr(&quot;y&quot;, function (d) &#123;
            return d.y;
        &#125;);
&#125;
    
    //直方图svg2
    var svg2=d3.select(&quot;#svg2&quot;)
               .attr(&quot;width&quot;,w)
               .attr(&quot;height&quot;,h);
    
    // x轴
    var xScale = d3.scaleOrdinal()
                   .domain(city)
                      .range([200,240,280,320,360,400,440,480,520,560,600,640,680,720,760,800,840,880,920,960,1000,1040,1080,1120,1160,1200,1240,1280,1320,1360,1400,1440]);
    var xAxis = d3.axisBottom()
                  .scale(xScale);
    svg2.append(&#39;g&#39;)
        .call(xAxis)
        .attr(&quot;transform&quot;, &quot;translate(0,&quot; + (h - padding.bottom) + &quot;)&quot;)
        .selectAll(&quot;text&quot;)
        .attr(&quot;dx&quot;, &quot;20px&quot;)
        .attr(&quot;font-size&quot;, &quot;14px&quot;);
            
    // y轴      
    var yScale = d3.scaleLinear()
                   .domain([0, 140000000])
                   .range([h - padding.bottom, padding.top]);
    var yAxis = d3.axisLeft()
                  .scale(yScale)
                  .ticks(7);
    svg2.append(&#39;g&#39;)
        .call(yAxis)
        .attr(&quot;transform&quot;, &quot;translate(&quot; + 200 + &quot;,0)&quot;);
            
    var bar = svg2.selectAll(&quot;.bar&quot;)
                    .data(population)
                  .enter().append(&quot;g&quot;)
                  .attr(&quot;class&quot;, &quot;bar&quot;)
                  .attr(&quot;transform&quot;, function(d, i) &#123;
                    return &quot;translate(&quot; + (xScale(i * 30)+5) + &quot;,&quot; + yScale(d) + &quot;)&quot;;
                &#125;);
            
    bar.append(&quot;rect&quot;)
       .attr(&quot;x&quot;,1)
       .attr(&quot;width&quot;, 30)
       .attr(&quot;height&quot;, function(d) &#123;
          return h - yScale(d) - padding.bottom;
        &#125;)
        .attr(&quot;fill&quot;,function(d,i)&#123;
            return d3.rgb(100+i*3,d*0.0000015,220-i)
        &#125;)
                  
    //(1)鼠标悬停时变为橘黄色
   .on(&quot;mouseover&quot;,function(d,i)&#123;
    d3.select(this)
    .attr(&quot;fill&quot;,&quot;orange&quot;);
    p.text(city[i] + &quot;:&quot; + d + &quot;人&quot;) // 显示数字
   &#125;)
    //(2)鼠标离开时恢复，利用之前学习的动画慢慢过渡
   .on(&quot;mouseout&quot;,function(d)&#123;
        d3.select(this)
          .transition()
          .duration(250)
          .attr(&quot;fill&quot;,function(d,i)&#123;
                return d3.rgb(100+i*3,d*0.0000015,220-i);
           &#125;);
        p.text(&quot;-------&quot;); // 删除数字
    &#125;);
    
    var p = d3.select(&quot;body&quot;) // 用于鼠标放在柱状图上时，在屏幕上显示数字。
    .selectAll(&quot;#myText&quot;)
    .text(&quot;-------&quot;);
    
    //饼图svg3
    var svg3=d3.select(&quot;#svg3&quot;)
               .attr(&quot;width&quot;,w)
               .attr(&quot;height&quot;,h);    

    let g1 = svg3.append(&#39;g&#39;)
               .attr(&#39;transform&#39;, &#39;translate( 350, 80 )&#39;)

    //设置饼图的半径
    let radius = Math.min(w, h) * 0.8 / 2

    let arc = d3.arc()
                .innerRadius(70)
             // .outerRadius(radius)
                .cornerRadius(10)

    //饼图与文字相连的曲线起点
    let pointStart = d3.arc()
  .innerRadius(radius)
  .outerRadius(radius)
//饼图与文字相连的曲线终点
let pointEnd = d3.arc()
  .innerRadius(radius + 20)
  .outerRadius(radius + 40)

let drawData = d3
  .pie()
  .value(function(d) &#123;
    return d.y
  &#125;)
  .sort(null)
  .sortValues(null)
  .startAngle(0)
  .endAngle(Math.PI * 2)
  .padAngle(0.05)(sexData)
console.log(drawData)

let colorScale = d3
  .scaleOrdinal()
  .range([&quot;#B2EBF2&quot;,&quot;#2196F3&quot;]);
</code></pre>
<p>   g1.append(‘g’)<br>      .attr(‘transform’, ‘translate( ‘ + radius + ‘, ‘ + radius + ‘ )’)<br>      .attr(‘stroke’, ‘steelblue’)<br>      .attr(‘stroke-width’, 1)<br>      .selectAll(‘path’)<br>      .data(drawData)<br>      .enter()<br>      .append(‘path’)<br>      .attr(‘fill’, function(d){<br>            return colorScale(d.index)<br>       })<br>      .attr(‘d’, function(d) {<br>        d.outerRadius = radius;<br>        return arc(d)<br>      })<br>      .on(‘mouseover’, arcTween(radius + 20, 0))<br>      .on(‘mouseout’, arcTween(radius, 150))<br>      .transition()<br>      .duration(2000)<br>      .attrTween(‘d’, function (d) {<br>      //初始加载时的过渡效果<br>        let fn = d3.interpolate({<br>          endAngle: d.startAngle<br>        }, d)<br>        return function(t) {<br>          return arc(fn(t))<br>        }<br>      })</p>
<pre><code>function arcTween(outerRadius, delay) &#123;
  // 设置缓动函数,为鼠标事件使用
  return function() &#123;
    d3.select(this)
      .transition()
      .delay(delay)
      .attrTween(&#39;d&#39;, function(d) &#123;
        let i = d3.interpolate(d.outerRadius, outerRadius)
        return function(t) &#123;
          d.outerRadius = i(t)
          return arc(d)
        &#125;
      &#125;)
  &#125;
&#125;

//文字层
let sum = d3.sum(sexData, d =&gt; d.y);
svg3.append(&#39;g&#39;)
  .attr(&#39;transform&#39;, &#39;translate( &#39; + (radius+350) + &#39;, &#39; + (radius+80) + &#39; )&#39;)
  .selectAll(&#39;text&#39;)
  .data(drawData)
  .enter()
  .append(&#39;text&#39;)
  .attr(&#39;transform&#39;, function(d) &#123;
  // arc.centroid(d)将文字平移到弧的中心
    return &#39;translate(&#39; + (arc.centroid(d)) + &#39;) &#39; +
      //rotate 使文字旋转扇形夹角一半的位置(也可不旋转)
      &#39;rotate(&#39; + (-90 + (d.startAngle + (d.endAngle - d.startAngle)/2) * 180 / Math.PI) + &#39;)&#39;
  &#125;)
        //文字开始点在文字中间
  .attr(&#39;text-anchor&#39;, &#39;middle&#39;)
        //文字垂直居中
  .attr(&#39;dominant-baseline&#39;, &#39;central&#39;)
  .attr(&#39;font-size&#39;, &#39;20px&#39;)
        //格式化文字显示格式
  .text(function(d) &#123;
    return (d.data.y / sum * 100).toFixed(2) + &#39;%&#39;;
  &#125;)
  // .attr(&#39;rotate&#39;, &#39;30&#39;) //此设置为设置每个文字中字符的旋转，上面的旋转是以文字为一个整体的旋转

//图例legend
let legend = g1.append(&#39;g&#39;)
  .attr(&#39;transform&#39;, &#39;translate( &#39; + radius * 2.7 + &#39;, 20 )&#39;)
  .selectAll(&#39;g1&#39;)
  .data(drawData)
  .enter()
  .append(&#39;g&#39;)
  .attr(&#39;transform&#39;, function(d, i) &#123;
    return &#39;translate(0,&#39; + i * 40 + &#39;)&#39;
  &#125;);

legend
  .append(&#39;rect&#39;)
  .attr(&#39;width&#39;, 40)
  .attr(&#39;height&#39;, 20)
  .attr(&#39;fill&#39;, function(d) &#123;
    //return colorScale(d.index)
    return colorScale(d.index)
  &#125;);
legend
  .append(&#39;text&#39;)
  .text(function(d) &#123;
    return d.data.x
  &#125;)
  .style(&#39;font-size&#39;, 15)
  .attr(&#39;y&#39;, &#39;1em&#39;)
  .attr(&#39;x&#39;, &#39;3em&#39;)
  .attr(&#39;dy&#39;, 1)

//曲线层
g1.append(&#39;g&#39;)
  .attr(&#39;transform&#39;, &#39;translate( &#39; + radius + &#39;, &#39; + radius + &#39; )&#39;)
  .selectAll(&#39;path&#39;)
  .data(drawData)
  .enter()
  .append(&#39;path&#39;)
  .attr(&#39;d&#39;,
    d3
      .linkHorizontal()
      .source(function(d) &#123;
        return pointStart.centroid(d)
      &#125;)
      .target(function(d) &#123;
        return pointEnd.centroid(d)
      &#125;)
  )
  .style(&#39;stroke&#39;, &#39;#999&#39;)
  .style(&#39;stroke-width&#39;, 1)
  .attr(&#39;fill&#39;, &#39;none&#39;)

//饼图外面的文字
g1.append(&#39;g&#39;)
  .attr(&#39;transform&#39;, &#39;translate( &#39; + radius + &#39;, &#39; + radius + &#39; )&#39;)
  .selectAll(&#39;path&#39;)
  .data(drawData)
  .enter()
  .append(&#39;text&#39;)
  .text(function(d) &#123;
    return d.data.x
  &#125;)
  .attr(&#39;x&#39;, function(d) &#123;
    return pointEnd.centroid(d)[0]
  &#125;)
  .attr(&#39;y&#39;, function(d) &#123;
    return pointEnd.centroid(d)[1]
  &#125;)
  .style(&#39;font-size&#39;, 20)
  .attr(&#39;text-anchor&#39;, function(d) &#123;
    if (d.startAngle &gt; Math.PI) &#123;
      return &#39;end&#39;
    &#125;
  &#125;)
  .attr(&#39;dominant-baseline&#39;, function(d) &#123;
    if (d.index === 4) &#123;
      return &#39;hanging&#39;
    &#125;
  &#125;)        
&lt;/script&gt;
</code></pre>
</html>